# shortify
Домашнее задание по мастерклассу от 8-9 мая 2017 года.

Инструкция по запуску :
1) Скачать архив с кассандрой по ссылке : https://cloud.mail.ru/public/2QQ3/VFfsy4XNK
2) Скачать архив с приложением : https://cloud.mail.ru/public/MaVH/JSBptHZYL
3) Импортивать это архивый как докер-контейнеры (docker import ...)
4) Запустить контейнер с кассандрой, обождать секунд 30
5) Запустить контейнер с приложением, подождать секунд 15
6) Изначальный запуск докер-имиджа выполнялся на порту 8080, поэтому нужно предварительно убедиться что порт не занят. 
После выполенения инструкций приложение будет доступно по адресу localhost:8080

Инструкции к приложению :
1) сгенерировать линк можно в рутовом разделе
2) по полученному шортлинку можно перейти и произойдёт редирект
3) статистику по вызовам можно посмотреть на localhost:8080/stat/visits/<shortlink>
4) список всех сгенерённых шортлинков будет по адресу localhost:8080/stat/shortlinks
По статистике ответы в JSON формате

Замечания :
т.к. при локальном запуске протестировать с реальных IP не было возможности, а толку от внутреннего приватного адреса типа 172. ... никакого, 
то внутри просто захардкожен какой-то латвийский IP адрес. Если страна не определилась, то остаётся так же unknown. Из задания 
я не очень понял как надо было сделать.

По архитектуре :
1) Приложение написано, основываясь на spring boot (о чём я уже много раз пожалел). Командный интерфейс на действия пользователя 
осуществляется посредством REST-контроллеров (Все в пакете lv.devternity.shortity.rest). 
2) Если обойтись без визуальных диаграмм, то вкратце : контроллеры настроены получать только определённый формат команд, далее они
создают Command из аргументов запроса, передают в ApplicationGateway вызовом execute*, где * - дополнительные условия. Например,
команда, требующая доступа к внешним сервисам, проходит через executeRemote()
3) Связть между командами и реакциями осуществляется через спринг и рефлекшен. (Команда указыват класс реакций - 
Class<? extends Reaction> reactionClass();)
4) ApplicationGateway содержит разные типы исполнителей команд. Туннели из них как таковые не стоятся, они скорее наследуются по 
необходимости (SafeRemoteImmediateImpl наследуется от ImmediateImpl)
5) По валидации : создание шортлика происходит от непроверенных параметров, только когда они удовлетворяют всем требованиям,
можно получить объект типа ShortLink (у него приватный конструктор). Валидация на нехорошие слова происходит через блум-фильтр,
инициализирующийся при запуске приложения.
6) Хронологический порядок визитов обеспечивается комплексным ключом в кассандре с сортировкой.
7) CRUD-Репозитории обеспечены спринговой библиотекой. Едиснтвенный дозапрос нужно было написать в VisitRepository.
8) VeriPacks запускал некоторое время назад, немного юнит-тестов тоже есть.
